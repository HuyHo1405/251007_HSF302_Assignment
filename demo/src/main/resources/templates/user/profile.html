<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{layout/base :: head('Thông tin cá nhân')}"></head>
<body th:replace="~{layout/base :: layout(~{::content}, 'Thông tin cá nhân', 'Xem và cập nhật hồ sơ người dùng')}">
<main th:fragment="content">
    <div class="glass-card mx-auto" style="max-width: 960px;">
        <div th:if="${success}" class="alert-glass mb-3" role="alert">
            <i class="bi bi-check-circle"></i> <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="alert-glass alert-danger mb-3" role="alert">
            <i class="bi bi-exclamation-triangle"></i> <span th:text="${error}"></span>
        </div>

        <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between gap-4 mb-4">
            <div class="d-flex align-items-center gap-3">
                <div class="avatar-ring" style="width:96px;height:96px;">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div>
                    <h2 class="mb-1" th:text="${user.fullName}">Họ và tên</h2>
                    <span class="status-badge"
                          th:classappend="${user.role.toString() == 'ADMIN'} ? ' status-cancelled' : (${user.role.toString() == 'STAFF'} ? ' status-pending' : ' status-paid')"
                          th:text="${user.role}">CUSTOMER</span>
                </div>
            </div>
            <div class="chip">
                <i class="bi bi-calendar-event"></i>
                <span>Ngày tạo:</span>
                <strong th:text="${user.createdAt != null ? user.createdAt : '---'}">01/01/2025</strong>
            </div>
        </div>

        <div class="summary-grid">
            <div class="summary-item">
                <h4><i class="bi bi-telephone me-2"></i>Số điện thoại</h4>
                <p class="mb-0" th:text="${user.phoneNumber}">0123456789</p>
            </div>
            <div class="summary-item">
                <h4><i class="bi bi-envelope me-2"></i>Email</h4>
                <p class="mb-0" th:text="${user.emailAddress}">email@example.com</p>
            </div>
            <div class="summary-item">
                <h4><i class="bi bi-geo-alt me-2"></i>Địa chỉ</h4>
                <p class="mb-0" th:text="${user.fullAddress}">Chưa cập nhật</p>
            </div>
        </div>

        <div class="d-flex flex-column flex-md-row flex-wrap gap-3 mt-4">
            <div th:if="${viewingOtherUser != null and viewingOtherUser}">
                <a href="/users/list" class="btn-secondary">
                    <i class="bi bi-arrow-left"></i> Quay lại danh sách
                </a>
                <form th:if="${user.role.toString() != 'ADMIN'}"
                      sec:authorize="hasRole('ADMIN')"
                      th:action="@{/users/{id}/delete(id=${user.id})}"
                      method="post"
                      onsubmit="return confirm('Bạn có chắc muốn xóa người dùng này? Hành động này không thể hoàn tác!')">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn-danger">
                        <i class="bi bi-trash"></i> Xóa người dùng
                    </button>
                </form>
            </div>
            <div class="d-flex flex-column flex-md-row gap-3" th:if="${viewingOtherUser == null or !viewingOtherUser}">
                <a href="/users/profile/edit" class="btn-primary">
                    <i class="bi bi-pencil"></i> Chỉnh sửa thông tin
                </a>
                <a href="/home" class="btn-secondary">
                    <i class="bi bi-house"></i> Về trang chủ
                </a>
                <form th:if="${user.role.toString() != 'ADMIN'}"
                      th:action="@{/users/{id}/delete(id=${user.id})}"
                      method="post"
                      onsubmit="return confirm('Bạn có chắc muốn xóa tài khoản? Hành động này không thể hoàn tác!')">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn-danger">
                        <i class="bi bi-trash"></i> Xóa tài khoản
                    </button>
                </form>
            </div>
        </div>
    </div>
</main>
</body>
</html>