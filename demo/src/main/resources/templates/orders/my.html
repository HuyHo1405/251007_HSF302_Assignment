<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{layout/base :: head('Đơn hàng của tôi')}"></head>
<body th:replace="~{layout/base :: layout(~{::content}, 'Đơn hàng của tôi', 'Theo dõi tình trạng các đơn hàng cá nhân')}">
<main th:fragment="content">
    <div class="glass-card">
        <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between gap-3 mb-4">
            <div>
                <h2 class="mb-1"><i class="bi bi-bag-check me-2"></i>Đơn hàng đã đặt</h2>
                <p class="text-secondary mb-0">Bạn có thể lọc theo trạng thái để tìm nhanh đơn hàng cần xem</p>
            </div>
            <a href="/products/list" class="btn-secondary">
                <i class="bi bi-box-seam"></i> Tiếp tục mua hàng
            </a>
        </div>

        <form th:action="@{/orders/my}" method="get" class="filter-section mb-4">
            <div class="row g-3 align-items-center">
                <div class="col-md-9 col-lg-10">
                    <label for="status" class="form-label mb-1">Trạng thái đơn hàng</label>
                    <select class="form-select" id="status" name="status">
                        <option value="" th:selected="${status == null or #strings.isEmpty(status)}">Tất cả</option>
                        <option value="PENDING" th:selected="${status == 'PENDING'}">Pending</option>
                        <option value="PAID" th:selected="${status == 'PAID'}">Paid</option>
                        <option value="SHIPPING" th:selected="${status == 'SHIPPING'}">Shipping</option>
                        <option value="DELIVERED" th:selected="${status == 'DELIVERED'}">Delivered</option>
                        <option value="CANCELLED" th:selected="${status == 'CANCELLED'}">Cancelled</option>
                    </select>
                </div>
                <div class="col-md-3 col-lg-2">
                    <button type="submit" class="btn-primary w-100 justify-content-center">
                        <i class="bi bi-funnel"></i> Lọc
                    </button>
                </div>
            </div>
        </form>

        <div th:if="${orders != null and !orders.isEmpty()}">
            <div class="table-responsive">
                <table class="table-glass">
                    <thead>
                    <tr>
                        <th>Mã ĐH</th>
                        <th>Ngày đặt</th>
                        <th>Tổng tiền</th>
                        <th>Trạng thái</th>
                        <th class="text-end">Hành động</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="order : ${orders}">
                        <td><strong th:text="'#' + ${order.id}">#1</strong></td>
                        <td>
                            <span class="badge-outline">
                                <i class="bi bi-calendar-event"></i>
                                <span th:text="${order.createdAt != null ? order.createdAt : 'Chưa cập nhật'}"></span>
                            </span>
                        </td>
                        <td th:text="${order.totalPrice != null ? #numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT') + ' ₫' : '0 ₫'}" class="fw-semibold text-info"></td>
                        <td>
                            <span class="status-badge"
                                  th:classappend="${order.status != null ? ' status-' + #strings.toLowerCase(order.status) : ''}"
                                  th:text="${order.status != null ? order.status : 'N/A'}"></span>
                        </td>
                        <td class="text-end">
                            <div class="d-inline-flex gap-2">
                                <a th:href="@{/orders/{id}(id=${order.id})}" class="btn-primary btn-sm">
                                    <i class="bi bi-eye"></i> Chi tiết
                                </a>
                                <a th:if="${order.status == null or !#strings.equalsIgnoreCase(order.status, 'PAID')}" th:href="@{/payments/create/{id}(id=${order.id})}" class="btn-secondary btn-sm">
                                    <i class="bi bi-credit-card"></i> Thanh toán
                                </a>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div th:if="${orders == null or orders.isEmpty()}" class="empty-state">
            <i class="bi bi-inbox"></i>
            <h4 class="mt-3">Bạn chưa có đơn hàng nào</h4>
            <p class="text-secondary">Hãy khám phá sản phẩm yêu thích và đặt hàng ngay hôm nay.</p>
            <a href="/products/list" class="btn-primary mt-3">
                <i class="bi bi-cart-plus"></i> Mua sắm ngay
            </a>
        </div>
    </div>
</main>
</body>
</html>