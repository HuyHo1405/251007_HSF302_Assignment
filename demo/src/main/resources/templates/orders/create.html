<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{layout/base :: head('Xác nhận đơn hàng')}"></head>
<body th:replace="~{layout/base :: layout(~{::content}, 'Xác nhận đơn hàng', 'Kiểm tra lại thông tin trước khi đặt hàng')}">
<main th:fragment="content">
    <div class="glass-card">
        <div class="text-center mb-4">
            <div class="avatar-ring mx-auto mb-3">
                <i class="bi bi-clipboard-check"></i>
            </div>
            <h2 class="mb-1">Xác nhận đơn hàng</h2>
            <p class="text-secondary mb-0">Vui lòng đọc kỹ thông tin trước khi nhấn xác nhận</p>
        </div>

        <div class="summary-grid">
            <div class="summary-item">
                <h4><i class="bi bi-person me-2"></i>Thông tin khách hàng</h4>
                <p class="mb-1"><strong>Họ tên:</strong> <span th:text="${order.userFullName}">---</span></p>
                <p class="mb-1"><strong>Địa chỉ:</strong> <span th:text="${userAddress != null ? userAddress : 'Chưa cập nhật'}">Chưa cập nhật</span></p>
                <p class="mb-0"><strong>Số lượng sản phẩm:</strong> <span th:text="${order.items != null ? order.items.size() : 0}">0</span></p>
            </div>
            <div class="summary-item">
                <h4><i class="bi bi-receipt me-2"></i>Tổng quan đơn hàng</h4>
                <p class="mb-1"><strong>Tạm tính:</strong> <span th:text="${#numbers.formatDecimal(orderSubtotal, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span></p>
                <p class="mb-1"><strong>Phí vận chuyển:</strong> <span th:text="${#numbers.formatDecimal(30000, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span></p>
                <p class="mb-0"><strong>Tổng thanh toán:</strong> <span th:text="${#numbers.formatDecimal(orderTotal, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span></p>
            </div>
        </div>

        <section class="mt-5">
            <h3 class="mb-3"><i class="bi bi-box-seam me-2"></i>Sản phẩm trong đơn</h3>
            <div class="table-responsive">
                <table class="table-glass">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Tên sản phẩm</th>
                        <th>Đơn giá</th>
                        <th>Số lượng</th>
                        <th>Thành tiền</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Danh sách sản phẩm -->
                    <tr th:each="item, iterStat : ${order.items}">
                        <td th:text="${iterStat.count}">1</td>
                        <td th:text="${item.productName}">Laptop</td>
                        <td th:text="${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                        <td th:text="${item.quantity}"></td>
                        <td th:text="${#numbers.formatDecimal(item.subtotal, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                    </tr>

                    <!-- Hàng phí vận chuyển -->
                    <tr style="border-top: 2px solid rgba(255,255,255,0.1);">
                        <td colspan="4" class="text-end"><strong>Phí vận chuyển</strong></td>
                        <td><strong th:text="${#numbers.formatDecimal(shippingFee, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></strong></td>
                    </tr>

                    <!-- Hàng tổng cộng -->
                    <tr style="background: rgba(13, 110, 253, 0.1); border-top: 2px solid rgba(13, 110, 253, 0.3);">
                        <td colspan="4" class="text-end"><strong style="font-size: 1.1em;">Tổng</strong></td>
                        <td><strong style="font-size: 1.1em; color: #0d6efd;" th:text="${#numbers.formatDecimal(orderTotal, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></strong></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <form th:action="@{/orders/create}" method="post" class="mt-5">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="mb-4">
                <h3 class="mb-3"><i class="bi bi-geo-alt me-2"></i>Địa chỉ giao hàng</h3>
                <div class="form-floating">
                    <textarea
                        class="form-control"
                        id="shippingAddress"
                        name="shippingAddress"
                        placeholder="Nhập địa chỉ giao hàng"
                        required
                        style="height: 100px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: #f8fafc;"
                        th:text="${order.shippingAddress}"></textarea>
                    <label for="shippingAddress">Địa chỉ giao hàng <span class="text-danger">*</span></label>
                </div>
                <small class="text-secondary d-block mt-2">
                    <i class="bi bi-info-circle me-1"></i>
                    Vui lòng nhập đầy đủ: Số nhà, tên đường, phường/xã, quận/huyện, tỉnh/thành phố
                </small>
            </div>

            <div class="text-center">
                <div class="d-inline-flex flex-wrap gap-3 justify-content-center">
                    <button type="submit" class="btn-primary btn-lg">
                        <i class="bi bi-check-circle"></i> Xác nhận đặt hàng
                    </button>
                    <a href="/cart" class="btn-secondary btn-lg">
                        <i class="bi bi-arrow-left"></i> Quay lại giỏ hàng
                    </a>
                </div>
            </div>
        </form>
    </div>
</main>
</body>
</html>