<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/base :: head('Lịch sử thanh toán')}"></head>
<body th:replace="~{layout/base :: layout(~{::content}, 'Lịch sử thanh toán', 'Theo dõi các giao dịch gắn với đơn hàng')}">
<main th:fragment="content">
    <div class="glass-card">
        <div class="d-flex flex-column flex-lg-row justify-content-lg-between align-items-lg-center gap-3 mb-4">
            <div>
                <h2 class="mb-1"><i class="bi bi-credit-card me-2"></i>Đơn hàng #<span th:text="${orderId}">0</span></h2>
                <p class="text-secondary mb-0">Danh sách giao dịch đã thực hiện</p>
            </div>
            <a th:href="@{'/orders/' + ${orderId}}" class="btn-secondary">
                <i class="bi bi-arrow-left"></i> Quay lại chi tiết đơn
            </a>
        </div>

        <div class="table-responsive">
            <table class="table-glass">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Phương thức</th>
                    <th>Số tiền</th>
                    <th>Trạng thái</th>
                    <th>Ngày thanh toán</th>
                    <th class="text-end">Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="payment : ${payments}">
                    <td th:text="${payment.id}">1</td>
                    <td th:text="${payment.paymentMethod}">VNPay</td>
                    <td th:text="${payment.amount != null ? #numbers.formatDecimal(payment.amount, 0, 'COMMA', 0, 'POINT') + ' ₫' : '---'}"></td>
                    <td>
                        <span class="status-badge"
                              th:classappend="${payment.status != null ? ' status-' + #strings.toLowerCase(payment.status) : ''}"
                              th:text="${payment.status != null ? payment.status : 'N/A'}"></span>
                    </td>
                    <td th:text="${payment.paidAt != null ? #temporals.format(payment.paidAt, 'dd/MM/yyyy HH:mm') : '---'}"></td>
                    <td class="text-end">
                        <form th:if="${payment.status}=='pending'"
                              th:action="@{'/orders/' + ${orderId} + '/payments/' + ${payment.id} + '/complete'}"
                              method="post" class="d-inline-flex">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn-primary btn-sm">
                                <i class="bi bi-check-circle"></i> Hoàn thành
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-end gap-3 mt-4">
            <a th:href="@{'/orders/' + ${orderId} + '/payments/create'}" class="btn-primary">
                <i class="bi bi-plus-circle"></i> Thêm giao dịch mới
            </a>
        </div>
    </div>
</main>
</body>
</html>
