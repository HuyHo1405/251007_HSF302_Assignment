<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{layout/base :: head('HSF302 Shop - Trang chủ')}"></head>
<body th:replace="~{layout/base :: layout(~{::content}, null, null)}">
<main th:fragment="content">
    <section class="hero-section">
        <div class="hero-headline">Khám phá thế giới Laptop Hiệu Năng Cao</div>
        <p class="hero-tagline">Top 10 sản phẩm bán chạy nhất với sức mạnh xử lý vượt trội, sẵn sàng cho mọi nhu cầu học tập và công việc.</p>
        <a href="#best-sellers" class="hero-cta">
            <i class="bi bi-lightning-charge-fill"></i>
            Xem ngay Top 10 Best Seller
        </a>
    </section>

    <section id="best-sellers" class="glass-card">
        <div class="d-flex flex-column flex-lg-row justify-content-lg-between align-items-lg-center gap-3 mb-4">
            <h2 class="m-0"><i class="bi bi-trophy-fill me-2 text-warning"></i>Top 10 sản phẩm bán chạy</h2>
            <span class="badge-outline">
                <i class="bi bi-activity"></i>
                Luôn cập nhật theo doanh số đơn giao thành công
            </span>
        </div>

        <div th:if="${topProducts != null && !topProducts.isEmpty()}" class="card-grid">
            <div class="product-card" th:each="product, iterStat : ${topProducts}">
                <div class="product-image" th:style="|background-image: url('${product.imageUrl != null && !product.imageUrl.isEmpty() ? product.imageUrl : 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=1200&q=80'}')|">
                    <span class="product-rank">
                        <i class="bi bi-star-fill text-warning"></i>
                        Top <span th:text="${iterStat.index + 1}"></span>
                    </span>
                </div>
                <div class="product-body">
                    <div class="product-title" th:text="${product.name}">Laptop</div>
                    <div class="product-meta">
                        <span><i class="bi bi-building"></i> <span th:text="${product.brand}">Thương hiệu</span></span>
                        <span><i class="bi bi-currency-exchange"></i> Đã bán: <span th:text="${product.totalSold}"></span></span>
                    </div>
                    <div class="product-price" th:text="${#numbers.formatDecimal(product.unitPrice, 0, 'POINT', 0, 'POINT')} + ' VND'">25.000.000 VND</div>
                    <div class="product-actions">
                        <form th:action="@{/cart/add}" method="post" sec:authorize="hasAnyRole('CUSTOMER')" class="w-100">
                            <input type="hidden" name="productId" th:value="${product.id}"/>
                            <input type="hidden" name="quantity" value="1"/>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn-primary w-100 justify-content-center">
                                <i class="bi bi-cart-plus me-2"></i>Thêm vào giỏ
                            </button>
                        </form>
                        <a sec:authorize="isAnonymous()" href="/auth/login" class="btn-login w-100 justify-content-center">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Đăng nhập để mua
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${topProducts == null || topProducts.isEmpty()}" class="empty-state">
            <i class="bi bi-emoji-neutral fs-1 text-warning"></i>
            <h4 class="mt-3">Chưa có dữ liệu bán chạy</h4>
            <p>Hãy thêm sản phẩm và thực hiện đơn hàng đầu tiên để xem bảng xếp hạng xuất hiện.</p>
        </div>
    </section>
</main>
</body>
</html>
